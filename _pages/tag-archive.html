---
layout: archive
permalink: /tags/
title: "Adventure Tags"
author_profile: true
---

{% include base_path %}

<h1 id="tags-header">All Adventure Tags</h1>

{% assign all_adventure_tags = "" | split: "" %}

{%- comment -%}
  Gather all tags from all adventures
{%- endcomment -%}
{% for adventure in site.adventures %}
  {% if adventure.tags %}
    {% assign all_adventure_tags = all_adventure_tags | concat: adventure.tags %}
  {% endif %}
{% endfor %}

{%- comment -%}
  Get unique, sorted list of tags
{%- endcomment -%}
{% assign unique_tags = all_adventure_tags | uniq | sort %}

<ul class="tag-list">
  {% for tag in unique_tags %}
    {% assign tagged_adventures = site.adventures | where_exp: "item", "item.tags contains tag" %}
    <li class="tag-item" data-tag="{{ tag }}" style="display: list-item;">
      <a href="#" class="tag-toggle" data-tag="{{ tag }}">
        {{ tag }} ({{ tagged_adventures | size }})
      </a>
      <ul id="tag-{{ tag | slugify }}" class="tag-posts" style="display:none;">
        {% for adventure in tagged_adventures %}
          <li>
            <a href="{{ adventure.url | relative_url }}">{{ adventure.title }}</a>
          </li>
        {% endfor %}
      </ul>
    </li>
  {% endfor %}
</ul>

<ul id="flat-post-list" style="display:none; list-style:none; padding-left:0;"></ul>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const tagItems = document.querySelectorAll(".tag-item");
    const tagToggles = document.querySelectorAll(".tag-toggle");
    const header = document.getElementById("tags-header");
    const flatPostList = document.getElementById("flat-post-list");

    function hideAllTags() {
      tagItems.forEach(item => item.style.display = "none");
    }

    function showAllTags() {
      tagItems.forEach(item => item.style.display = "list-item");
      flatPostList.style.display = "none";
      flatPostList.innerHTML = "";
      header.textContent = "All Adventure Tags";
    }

    function showOnlyTagFlat(tag) {
      // Hide all tag items
      hideAllTags();

      // Update header
      header.textContent = "Tags - " + tag;

      // Find all adventures for that tag
      const adventures = [];
      tagItems.forEach(item => {
        if(item.dataset.tag === tag) {
          // Collect the adventures from this tag's hidden UL
          const postLinks = item.querySelectorAll(".tag-posts li a");
          postLinks.forEach(a => {
            adventures.push({url: a.href, title: a.textContent});
          });
        }
      });

      // Clear and show flat list
      flatPostList.innerHTML = "";
      adventures.forEach(adventure => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = adventure.url;
        a.textContent = adventure.title;
        li.appendChild(a);
        flatPostList.appendChild(li);
      });
      flatPostList.style.display = "block";

      // Scroll to header
      header.scrollIntoView({behavior: "smooth", block: "start"});
    }

    // Click handlers on tag toggles to show flat list and update URL hash
    tagToggles.forEach(tagLink => {
      tagLink.addEventListener("click", function(e) {
        e.preventDefault();
        const tag = this.dataset.tag;
        showOnlyTagFlat(tag);
        history.replaceState(null, null, "#" + tag);
      });
    });

    // On page load, check if URL hash exists
    const hash = window.location.hash.substring(1);
    if(hash) {
      showOnlyTagFlat(hash);
    } else {
      showAllTags();
    }
  });
</script>

<style>
  .tag-list { list-style: none; padding: 0; }
  .tag-list > li { margin-bottom: 0.5em; }
  .tag-posts { margin-left: 1.5em; list-style: disc; }
  .tag-toggle { cursor: pointer; color: var(--link-color, #007acc); text-decoration: none; }
  .tag-toggle:hover { text-decoration: underline; }
  #flat-post-list li {
    margin-bottom: 0.3em;
  }
</style>
